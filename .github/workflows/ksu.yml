name: Ksunati

on:
  workflow_dispatch:
    inputs:
      KERNEL_REPO:
        description: 'Kernel Git Linkini YapÄ±ÅŸtÄ±r'
        required: true
        default: 'https://github.com/kullanici/cihaz_kernel'
      KERNEL_BRANCH:
        description: 'Branch AdÄ± (main, master vs.)'
        required: true
        default: 'main'
      ROOT_METHOD:
        description: 'Hangi Root YÃ¶ntemi Ã‡akÄ±lsÄ±n?'
        required: true
        default: 'KernelSU'
        type: choice
        options:
        - None
        - KernelSU
        - KernelSU-Next
        - APatch

jobs:
  build:
    runs-on: ubuntu-22.04
    
    steps:
    - name: Ortam HazÄ±rlÄ±ÄŸÄ± (GÃ¼ncelleme & Paketler)
      run: |
        sudo apt-get update
        sudo apt-get install -y git bc bison flex libssl-dev build-essential libncurses5-dev libncurses5
        # Buraya senin kernel iÃ§in gereken diÄŸer paketleri eklersin

    - name: Kernel KaynaÄŸÄ±nÄ± Ã‡ek
      run: |
        git clone --depth=1 -b ${{ inputs.KERNEL_BRANCH }} ${{ inputs.KERNEL_REPO }} android_kernel
        
    - name: ðŸ› ï¸ Root YÃ¶ntemini Entegre Et
      working-directory: android_kernel
      run: |
        echo "SeÃ§ilen YÃ¶ntem: ${{ inputs.ROOT_METHOD }}"
        
        if [ "${{ inputs.ROOT_METHOD }}" == "KernelSU" ]; then
            echo "KernelSU Orijinal Kuruluyor..."
            curl -LSs "https://raw.githubusercontent.com/tiann/KernelSU/main/kernel/setup.sh" | bash -
            
        elif [ "${{ inputs.ROOT_METHOD }}" == "KernelSU-Next" ]; then
            echo "KernelSU-Next (Fork) Kuruluyor..."
            curl -LSs "https://raw.githubusercontent.com/rifsxd/KernelSU-Next/next/kernel/setup.sh" | bash -
            
        elif [ "${{ inputs.ROOT_METHOD }}" == "APatch" ]; then
            echo "APatch Kuruluyor..."
            # APatch entegrasyonu genelde submodule veya patch ile olur, Ã¶rnek komut:
            git clone https://github.com/bmax121/APatch drivers/apatch
            # Buraya defconfig ayarlamalarÄ± gerekir, bu kÄ±sÄ±m kernele gÃ¶re deÄŸiÅŸir!
            
        else
            echo "Temiz kurulum, Root eklenmiyor."
        fi

    - name: Toolchain Ä°ndir (Proton Clang Ã–rneÄŸi)
      run: |
        git clone --depth=1 https://github.com/kdrag0n/proton-clang clang

    - name: Derlemeyi BaÅŸlat (Make)
      working-directory: android_kernel
      run: |
        export PATH=$GITHUB_WORKSPACE/clang/bin:$PATH
        export ARCH=arm64
        export SUBARCH=arm64
        export CROSS_COMPILE=aarch64-linux-gnu-
        export CC=clang
        
        # NOT: AÅŸaÄŸÄ±daki 'defconfig' adÄ±nÄ± senin cihaza gÃ¶re deÄŸiÅŸtirmen lazÄ±m!
        make O=out vendor_cepheus_defconfig 
        
        # KernelSU/APatch seÃ§ildiyse config'e ekleme yapÄ±lmasÄ± gerekebilir
        if [ "${{ inputs.ROOT_METHOD }}" != "None" ]; then
            echo "CONFIG_KSU=y" >> out/.config
            # APatch iÃ§in CONFIG_APATCH=y vs.
        fi
        
        make O=out -j$(nproc --all)

    - name: DosyayÄ± Paketle ve YÃ¼kle
      uses: actions/upload-artifact@v4
      with:
        name: Kernel-${{ inputs.ROOT_METHOD }}
        path: android_kernel/out/arch/arm64/boot/Image*
        
